<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<title>Quiz System</title>
<style>
body {font-family: Arial, sans-serif; background:#f4f6f8; padding:20px;}
.container{max-width:900px;margin:auto;background:#fff;padding:20px;border-radius:10px;box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);}
textarea,input,button{width:100%;margin-top:10px;padding:10px;border-radius:6px;border:1px solid #ccc;}
button{background:#2563eb;color:#fff;border:none;cursor:pointer;transition: background-color 0.2s;}
button:hover{background:#1e40af;}
.question{background:#f1f5f9;padding:15px;margin-top:15px;border-radius:8px;}
.hidden{display:none;}
.option-card{
  border:1px solid #ccc;
  padding:10px 15px;
  margin:8px 0;
  border-radius:6px;
  cursor:pointer;
  transition:0.2s;
  background:#fff;
}
.option-card:hover{background:#e2e8f0;}
.option-card.correct{background:#d4edda;border-color:#28a745;color:#155724;font-weight:bold;}
.option-card.wrong{background:#f8d7da;border-color:#dc3545;color:#721c24;}
</style>
</head>
<body>
<div class="container">
<h1>üß† Quiz System</h1>

<div id="modeSelect">
  <button onclick="setMode('teacher')">üë®‚Äçüè´ –ú“±“ì–∞–ª—ñ–º</button>
  <button onclick="setMode('student')">üë®‚Äçüéì –°—Ç—É–¥–µ–Ω—Ç</button>
</div>

<div id="teacher" class="hidden">
  <h2>–¢–µ—Å—Ç “õ“±—Ä–∞—Å—Ç—ã—Ä—É</h2>
  <textarea id="inputQuestions" rows="8" placeholder="–°“±—Ä–∞“õ | *–¥“±—Ä—ã—Å –∂–∞—É–∞–ø | –≤–∞—Ä–∏–∞–Ω—Ç2 | –≤–∞—Ä–∏–∞–Ω—Ç3 | –≤–∞—Ä–∏–∞–Ω—Ç4 | –≤–∞—Ä–∏–∞–Ω—Ç5"></textarea>
  <button onclick="createSession()">–°–µ—Å—Å–∏—è –∞—à—É</button>
  <p id="sessionInfo" style="margin-top: 15px; font-weight: bold; color: #2563eb;"></p>
</div>

<div id="student" class="hidden">
  <h2>–¢–µ—Å—Ç–∫–µ –∫—ñ—Ä—É</h2>
  <input id="sessionCodeInput" placeholder="–°–µ—Å—Å–∏—è –∫–æ–¥—ã–Ω –µ–Ω–≥—ñ–∑">
  <input id="studentName" placeholder="–ê—Ç—ã-–∂”©–Ω—ñ“£—ñ–∑">
  <button onclick="loadSession()">–ë–∞—Å—Ç–∞—É</button>
  
  <div id="quiz" style="margin-top: 20px;"></div>
  
  <div id="finishContainer" class="hidden">
    <button onclick="finishTest()">–ê—è“õ—Ç–∞—É</button>
  </div>

  <div id="result" style="margin-top: 20px; font-weight: bold;"></div>
</div>
</div>

<script>
let mode = '';
let quizData = [];
let startTime;
let sessionCode = '';
let studentMode = false;

function setMode(m){
  mode = m;
  document.getElementById('modeSelect').classList.add('hidden');
  document.getElementById(m).classList.remove('hidden');
  if (m === 'student') {
    studentMode = true;
  }
}

function shuffle(array) {
  // Fisher-Yates shuffle –∞–ª–≥–æ—Ä–∏—Ç–º—ñ
  for (let i = array.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [array[i], array[j]] = [array[j], array[i]];
  }
  return array;
}

function createSession(){
  const input = document.getElementById('inputQuestions').value.trim();
  if (!input) {
      alert('–°“±—Ä–∞“õ—Ç–∞—Ä–¥—ã –µ–Ω–≥—ñ–∑—ñ“£—ñ–∑!');
      return;
  }
  const lines = input.split('\n').filter(line => line.trim() !== ''); // –ë–æ—Å –∂–æ–ª–¥–∞—Ä–¥—ã —Å“Ø–∑—É
  quizData = [];
  
  lines.forEach(line => {
    const parts = line.split('|').map(p => p.trim());
    if (parts.length < 2) return; // –ú–∏–Ω–∏–º–∞–ª–¥—ã —Å“±—Ä–∞“õ + 1 –æ–ø—Ü–∏—è

    const questionText = parts[0];
    const allOptionsWithStar = parts.slice(1);

    // 1. –î“±—Ä—ã—Å –∂–∞—É–∞–ø—Ç—ã —Ç–∞–±–∞–º—ã–∑
    const correctOptionWithStar = allOptionsWithStar.find(p => p.startsWith('*'));
    if (!correctOptionWithStar) return; // –î“±—Ä—ã—Å –∂–∞—É–∞–ø —Ç–∞–±—ã–ª–º–∞—Å–∞, ”©—Ç–∫—ñ–∑—ñ–ø –∂—ñ–±–µ—Ä—É

    const correct = correctOptionWithStar.replace('*', '').trim();

    // 2. –î“±—Ä—ã—Å –µ–º–µ—Å –æ–ø—Ü–∏—è–ª–∞—Ä–¥—ã —Ç–∞–±–∞–º—ã–∑
    const wrongOptions = allOptionsWithStar
        .filter(p => p.trim() !== correctOptionWithStar) // *–±–∞—Ä –¥“±—Ä—ã—Å –∂–∞—É–∞–ø—Ç—ã –∞–ª—ã–ø —Ç–∞—Å—Ç–∞—É
        .map(p => p.replace('*', '').trim()) // “õ–∞–ª“ì–∞–Ω * –±–µ–ª–≥—ñ–ª–µ—Ä—ñ–Ω –∞–ª—ã–ø —Ç–∞—Å—Ç–∞—É
        .filter(p => p !== ''); // –±–æ—Å –∂–æ–ª–¥–∞—Ä–¥—ã –∞–ª—ã–ø —Ç–∞—Å—Ç–∞—É

    // 3. –î“±—Ä—ã—Å –∂–∞—É–∞–ø—Ç—ã –¥“±—Ä—ã—Å –µ–º–µ—Å –æ–ø—Ü–∏—è–ª–∞—Ä —Ç—ñ–∑—ñ–º—ñ–Ω–¥–µ “õ–∞–π—Ç–∞–ª–∞–Ω—É—ã–Ω —Ç–µ–∫—Å–µ—Ä–µ–º—ñ–∑ –∂”ô–Ω–µ –∞–ª—ã–ø —Ç–∞—Å—Ç–∞–π–º—ã–∑
    const uniqueWrongOptions = wrongOptions.filter(o => o !== correct);
    
    quizData.push({ q: questionText, options: uniqueWrongOptions, correct: correct });
  });

  if (quizData.length === 0) {
      alert('–°“±—Ä–∞“õ—Ç–∞—Ä –¥“±—Ä—ã—Å —Ñ–æ—Ä–º–∞—Ç—Ç–∞ –µ–Ω–≥—ñ–∑—ñ–ª–º–µ–≥–µ–Ω. ”ò—Ä –∂–æ–ª: "–°“±—Ä–∞“õ | *–î“±—Ä—ã—Å –ñ–∞—É–∞–ø | “ö–∞—Ç–µ –ñ–∞—É–∞–ø 1 | ..."');
      return;
  }

  sessionCode = Math.random().toString(36).substring(2, 7).toUpperCase();
  localStorage.setItem(sessionCode, JSON.stringify({ quizData, results: [] }));
  document.getElementById('sessionInfo').innerText = `‚úÖ –°–µ—Å—Å–∏—è —Å”ô—Ç—Ç—ñ –∞—à—ã–ª–¥—ã. –ö–æ–¥—ã: ${sessionCode}`;
}

function loadSession(){
  sessionCode = document.getElementById('sessionCodeInput').value.trim();
  const studentName = document.getElementById('studentName').value.trim();

  if (!sessionCode || !studentName) {
      alert('–°–µ—Å—Å–∏—è –∫–æ–¥—ã–Ω –∂”ô–Ω–µ –∞—Ç—ã-–∂”©–Ω—ñ“£—ñ–∑–¥—ñ –µ–Ω–≥—ñ–∑—ñ“£—ñ–∑.');
      return;
  }

  const data = JSON.parse(localStorage.getItem(sessionCode));
  if(!data){
      alert(`–°–µ—Å—Å–∏—è –∫–æ–¥—ã (¬´${sessionCode}¬ª) —Ç–∞–±—ã–ª–º–∞–¥—ã –Ω–µ–º–µ—Å–µ –¥“±—Ä—ã—Å –µ–º–µ—Å.`);
      return;
  }
  
  quizData = data.quizData;
  startTime = Date.now();
  
  // –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å—Ç—ñ –∂–∞“£–∞—Ä—Ç—É
  document.getElementById('sessionCodeInput').classList.add('hidden');
  document.getElementById('studentName').classList.add('hidden');
  document.querySelector('#student button').classList.add('hidden'); // '–ë–∞—Å—Ç–∞—É' –±–∞—Ç—ã—Ä–º–∞—Å—ã–Ω –∂–∞—Å—ã—Ä—É
  document.getElementById('finishContainer').classList.remove('hidden');

  const quizDiv = document.getElementById('quiz');
  quizDiv.innerHTML = '';
  
  quizData.forEach((q, i) => {
    const d = document.createElement('div');
    d.className = 'question';
    d.dataset.questionIndex = i; // –°“±—Ä–∞“õ –∏–Ω–¥–µ–∫—Å—ñ–Ω —Å–∞“õ—Ç–∞—É “Ø—à—ñ–Ω
    d.innerHTML = `<b>${i+1}. ${q.q}</b><br>`;
    
    // –û–ø—Ü–∏—è–ª–∞—Ä–¥—ã –∂–∏–Ω–∞—É (–¥“±—Ä—ã—Å –∂–∞—É–∞–ø + –¥“±—Ä—ã—Å –µ–º–µ—Å –∂–∞—É–∞–ø—Ç–∞—Ä) –∂”ô–Ω–µ –∞—Ä–∞–ª–∞—Å—Ç—ã—Ä—É
    let opts = shuffle([q.correct, ...q.options]);

    opts.forEach(o => {
      const div = document.createElement('div');
      div.className = 'option-card';
      div.innerText = o;
      div.onclick = function() {
        // –ï–≥–µ—Ä –±“±–ª —Å“±—Ä–∞“õ“õ–∞ –∂–∞—É–∞–ø –±–µ—Ä—ñ–ª–≥–µ–Ω –±–æ–ª—Å–∞, “õ–∞–π—Ç–∞ –±–∞—Å—É“ì–∞ —Ç—ã–π—ã–º —Å–∞–ª—É
        if (d.querySelector('.option-card.correct') || d.querySelector('.option-card.wrong')) return; 

        // –ñ–∞—É–∞–ø—Ç—ã —Ç–µ–∫—Å–µ—Ä—É
        const isCorrect = (o === q.correct);
        
        // –ë–∞—Ä–ª—ã“õ –æ–ø—Ü–∏—è–ª–∞—Ä–¥—ã“£ –∫“Ø–π—ñ–Ω –∫”©—Ä—Å–µ—Ç—É (–±—ñ—Ä —Ä–µ—Ç –±–∞—Å“õ–∞–Ω–Ω–∞–Ω –∫–µ–π—ñ–Ω)
        const siblings = d.querySelectorAll('.option-card');
        siblings.forEach(s => {
          if (s.innerText === q.correct) {
            s.classList.add('correct');
          } else {
            s.classList.add('wrong');
          }
          // –î“±—Ä—ã—Å –µ–º–µ—Å —Ç–∞“£–¥–∞—É“ì–∞ –∞—Ä–Ω–∞–ª“ì–∞–Ω –∞—Ä–Ω–∞–π—ã –±–µ–ª–≥—ñ
          if (s === div && !isCorrect) {
              s.classList.remove('wrong');
              s.classList.add('wrong'); // –î“±—Ä—ã—Å –µ–º–µ—Å –∂–∞—É–∞–ø—Ç—ã “õ—ã–∑—ã–ª–º–µ–Ω –±–µ–ª–≥—ñ–ª–µ—É
          }
        });
        
        // –¢–∞“£–¥–∞–ª“ì–∞–Ω –∂–∞—É–∞–ø—Ç—ã —Å–∞“õ—Ç–∞—É (—Ç–µ–∫—Å–µ—Ä—É “Ø—à—ñ–Ω)
        d.dataset.selectedAnswer = o;
      }
      d.appendChild(div);
    });

    quizDiv.appendChild(d);
  });
}

function finishTest(){
  let score = 0;
  let wrongQuestions = [];
  const quizDiv = document.getElementById('quiz');
  
  quizData.forEach((q, i) => {
    const questionElement = quizDiv.querySelector(`.question[data-question-index="${i}"]`);
    
    // –ñ–∞—É–∞–ø –±–µ—Ä—ñ–ª–≥–µ–Ω—ñ–Ω –∂”ô–Ω–µ –æ–ª –¥“±—Ä—ã—Å –µ–∫–µ–Ω—ñ–Ω —Ç–µ–∫—Å–µ—Ä—É
    const selectedAnswer = questionElement.dataset.selectedAnswer;

    if (selectedAnswer && selectedAnswer === q.correct) {
      score++;
    } else {
      wrongQuestions.push({
          question: q.q,
          correct: q.correct,
          selected: selectedAnswer || '–ñ–∞—É–∞–ø –±–µ—Ä—ñ–ª–º–µ–≥–µ–Ω'
      });
    }
  });

  const time = Math.floor((Date.now() - startTime) / 1000);
  const name = document.getElementById('studentName').value;
  const data = JSON.parse(localStorage.getItem(sessionCode));
  
  // –ù”ô—Ç–∏–∂–µ–Ω—ñ —Å–∞“õ—Ç–∞—É
  data.results.push({ name, score, total: quizData.length, time, wrong: wrongQuestions.map(w => w.question) });
  localStorage.setItem(sessionCode, JSON.stringify(data));
  
  const percent = Math.round((score / quizData.length) * 100);
  
  let resultHtml = `<h2>–ù”ò–¢–ò–ñ–ï</h2>`;
  resultHtml += `<p><strong>–ê—Ç—ã-–∂”©–Ω—ñ:</strong> ${name}</p>`;
  resultHtml += `<p><strong>–î“±—Ä—ã—Å –∂–∞—É–∞–ø—Ç–∞—Ä:</strong> ${score} / ${quizData.length} (${percent}%)</p>`;
  resultHtml += `<p><strong>–£–∞“õ—ã—Ç—ã:</strong> ${time} —Å–µ–∫—É–Ω–¥</p>`;
  
  if (wrongQuestions.length > 0) {
      resultHtml += `<p style="color: #dc3545; font-weight: bold;">“ö–∞—Ç–µ —Å“±—Ä–∞“õ—Ç–∞—Ä (${wrongQuestions.length}):</p>`;
      wrongQuestions.forEach(w => {
          resultHtml += `<div style="margin-top: 10px; padding: 10px; border: 1px dashed #dc3545;">`;
          resultHtml += `<strong>–°“±—Ä–∞“õ:</strong> ${w.question}<br>`;
          resultHtml += `–î“±—Ä—ã—Å –∂–∞—É–∞–ø: ${w.correct}<br>`;
          resultHtml += `–°—ñ–∑ —Ç–∞“£–¥–∞“ì–∞–Ω: ${w.selected}`;
          resultHtml += `</div>`;
      });
  }

  document.getElementById('result').innerHTML = resultHtml;
  document.getElementById('finishContainer').classList.add('hidden');
}
</script>
</body>
</html>