<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<title>Quiz System</title>
<style>
body {font-family: Arial; background:#f4f6f8; padding:20px;}
.container{max-width:900px;margin:auto;background:#fff;padding:20px;border-radius:10px;}
textarea,input,button{width:100%;margin-top:10px;padding:10px;}
button{background:#2563eb;color:#fff;border:none;border-radius:6px;cursor:pointer;}
.question{background:#f1f5f9;padding:15px;margin-top:15px;border-radius:8px;}
.hidden{display:none;}
.option-card{
  border:1px solid #ccc;
  padding:10px 15px;
  margin:8px 0;
  border-radius:6px;
  cursor:pointer;
  transition:0.2s;
  background:#fff;
}
.option-card:hover{background:#f0f0f0;}
.option-card.correct{background:#d4edda;border-color:#28a745;color:#155724;}
.option-card.wrong{background:#f8d7da;border-color:#dc3545;color:#721c24;}
</style>
</head>
<body>
<div class="container">
<h1>üß† Quiz System</h1>

<div id="modeSelect">
  <button onclick="setMode('teacher')">üë®‚Äçüè´ –ú“±“ì–∞–ª—ñ–º</button>
  <button onclick="setMode('student')">üë®‚Äçüéì –°—Ç—É–¥–µ–Ω—Ç</button>
</div>

<!-- TEACHER -->
<div id="teacher" class="hidden">
  <h2>–¢–µ—Å—Ç “õ“±—Ä–∞—Å—Ç—ã—Ä—É</h2>
  <textarea id="inputQuestions" rows="8" placeholder="–í–æ–ø—Ä–æ—Å | *–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π | –≤–∞—Ä–∏–∞–Ω—Ç2 | –≤–∞—Ä–∏–∞–Ω—Ç3 | –≤–∞—Ä–∏–∞–Ω—Ç4 | –≤–∞—Ä–∏–∞–Ω—Ç5"></textarea>
  <button onclick="createSession()">–°–µ—Å—Å–∏—è –∞—à—É</button>
  <p id="sessionInfo"></p>
</div>

<!-- STUDENT -->
<div id="student" class="hidden">
  <h2>–¢–µ—Å—Ç–∫–µ –∫—ñ—Ä—É</h2>
  <input id="sessionCodeInput" placeholder="–°–µ—Å—Å–∏—è –∫–æ–¥—ã–Ω –µ–Ω–≥—ñ–∑">
  <input id="studentName" placeholder="–ê—Ç—ã“£">
  <button onclick="loadSession()">–ë–∞—Å—Ç–∞—É</button>
  <div id="quiz"></div>
  <button onclick="finishTest()">–ê—è“õ—Ç–∞—É</button>
  <div id="result"></div>
</div>
</div>

<script>
let mode='';
let quizData=[];
let startTime;
let sessionCode='';

function setMode(m){
  mode=m;
  document.getElementById('modeSelect').classList.add('hidden');
  document.getElementById(m).classList.remove('hidden');
}

function createSession(){
  const lines=document.getElementById('inputQuestions').value.trim().split('\n');
  quizData=[];
  lines.forEach(line=>{
    const parts=line.split('|').map(p=>p.trim());
    const correct=parts.find(p=>p.startsWith('*')).replace('*','');
    const options=parts.slice(1).map(p=>p.replace('*','')).filter(o => o !== correct);
    quizData.push({q:parts[0],options,correct});
  });
  sessionCode=Math.random().toString(36).substring(2,7).toUpperCase();
  localStorage.setItem(sessionCode,JSON.stringify({quizData,results:[]}));
  document.getElementById('sessionInfo').innerText=`–°–µ—Å—Å–∏—è –∫–æ–¥—ã: ${sessionCode}`;
}

function shuffle(array) {
  return array.sort(() => Math.random() - 0.5);
}

function loadSession(){
  sessionCode = document.getElementById('sessionCodeInput').value;
  const data = JSON.parse(localStorage.getItem(sessionCode));
  if(!data){alert('–°–µ—Å—Å–∏—è —Ç–∞–±—ã–ª–º–∞–¥—ã'); return;}
  
  quizData = shuffle([...data.quizData]); // <-- —Å“±—Ä–∞“õ—Ç–∞—Ä–¥—ã –∫–µ–∑–¥–µ–π—Å–æ“õ –µ—Ç—É
  startTime = Date.now();
  
  const quizDiv = document.getElementById('quiz');
  quizDiv.innerHTML = '';
  
  quizData.forEach((q, i) => {
    const d = document.createElement('div');
    d.className = 'question';
    d.innerHTML = `<b>${i+1}. ${q.q}</b><br>`;
    
    let opts = [...q.options];
    if(!opts.includes(q.correct)) opts.push(q.correct);
    opts = shuffle(opts); // –∂–∞—É–∞–ø—Ç–∞—Ä–¥—ã –∫–µ–∑–¥–µ–π—Å–æ“õ –µ—Ç—É

    opts.forEach(o => {
      const div = document.createElement('div');
      div.className = 'option-card';
      div.innerText = o;
      div.onclick = () => {
        if(div.classList.contains('correct') || div.classList.contains('wrong')) return;
        if(o === q.correct) div.classList.add('correct');
        else div.classList.add('wrong');

        const siblings = div.parentNode.querySelectorAll('.option-card');
        siblings.forEach(s => {
          if(s.innerText === q.correct) s.classList.add('correct');
          if(s !== div && s.innerText !== q.correct) s.classList.add('wrong');
        });
      }
      d.appendChild(div);
    });

    quizDiv.appendChild(d);
  });
}


function finishTest(){
  let score=0;
  let wrong=[];
  quizData.forEach((q,i)=>{
    const sel=document.querySelector(`.question:nth-child(${i+1}) .option-card.correct`);
    if(sel) score++;
    else wrong.push(q.q);
  });
  const time=Math.floor((Date.now()-startTime)/1000);
  const name=document.getElementById('studentName').value;
  const data=JSON.parse(localStorage.getItem(sessionCode));
  data.results.push({name,score,time,wrong});
  localStorage.setItem(sessionCode,JSON.stringify(data));
  const percent=Math.round((score/quizData.length)*100);
  document.getElementById('result').innerText=`–ù”ô—Ç–∏–∂–µ: ${score}/${quizData.length} (${percent}%), –£–∞“õ—ã—Ç: ${time} —Å–µ–∫`;
}
</script>
</body>
</html>
